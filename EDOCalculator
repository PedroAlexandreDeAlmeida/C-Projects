#include <stdio.h>
#include <math.h>

int main() {
    int opcao;
    printf("=== Resolucao de EDOs ===\n");
    printf("Escolha o modelo:\n");
    printf("1 - EDO Separavel com Solucao Exponencial\n");
    printf("2 - EDO Linear de Primeira Ordem com Fator Integrante\n");
    printf("Opcao: ");
    scanf("%d", &opcao);

    if (opcao == 1) {
        // Modelo 1: EDO separável
        double a, t, yt, k, tcalc, ycalc;

        printf("\nModelo 1 selecionado: EDO Separavel com Solucao Exponencial\n");
        printf("Digite o valor inicial y(0) = a: ");
        scanf("%lf", &a);

        printf("Digite um valor t (diferente de 0): ");
        scanf("%lf", &t);
        if (t == 0) {
            printf("Erro: t nao pode ser zero.\n");
            return 1;
        }

        printf("Digite o valor correspondente y(t): ");
        scanf("%lf", &yt);
        if (a == 0) {
            printf("Erro: y(0) nao pode ser zero.\n");
            return 1;
        }

        k = (1.0 / t) * log(yt / a);
        printf("\nConstante k calculada: %lf\n", k);
        printf("Funcao determinada: y(t) = %.3lf * e^(%.3lf * t)\n", a, k);

        char continuar;
        do {
            printf("\nDigite um valor t' para calcular y(t'): ");
            scanf("%lf", &tcalc);

            ycalc = a * exp(k * tcalc);
            printf("Resultado: y(%.3lf) = %lf\n", tcalc, ycalc);

            printf("Deseja calcular outro t'? (s/n): ");
            scanf(" %c", &continuar);
        } while (continuar == 's' || continuar == 'S');
    }
    else if (opcao == 2) {
        // Modelo 2: EDO Linear com fator integrante
        double a, p, x0, y0, xcalc, ycalc, C;

        printf("\nModelo 2 selecionado: EDO Linear de Primeira Ordem com Fator Integrante\n");

        // Solicitar constantes
        printf("Digite a constante p (p(x) constante): ");
        scanf("%lf", &p);

        printf("Digite a constante a (g(x) = e^(a*x)): ");
        scanf("%lf", &a);

        // Verificação do caso p + a = 0
        if (p + a == 0) {
            printf("Erro: p + a nao pode ser zero.\n");
            return 1;
        }

        // Condição inicial
        printf("Digite x0: ");
        scanf("%lf", &x0);
        printf("Digite y0 = y(x0): ");
        scanf("%lf", &y0);

        // Mostrar passo a passo elegante
        printf("\nPasso a passo:\n");
        printf("1. Fator integrante: mu(x) = e^(∫p(x) dx)\n");
        printf("   Como p(x) é constante, ∫p(x) dx = p*x, entao mu(x) = e^(p*x)\n");

        printf("2. Multiplicando a equacao pelo fator integrante:\n");
        printf("   d/dx[y * mu(x)] = mu(x) * g(x) = e^(∫p dx) * e^(a*x)\n");

        printf("3. Integrando ambos os lados:\n");
        printf("   Integral de e^(∫p dx) * g(x) dx = Integral e^((p+a)*x) dx = e^((p+a)*x)/(p+a)\n");

        printf("4. Solucao geral: y(x) = e^(ax)/(p+a) + C * e^(-∫p dx)\n");

        // Calcular constante C usando condição inicial
        C = (y0 - exp(a*x0)/(p+a)) * exp(p*x0);
        printf("5. Usando a condicao inicial y(%.3lf) = %.3lf, obtemos C = %.3lf\n", x0, y0, C);

        // Mostrar solução do PVI explicitamente
        printf("\nResultado do PVI (solucao especifica):\n");
        printf("y(x) = e^(%.3lf*x)/(%.3lf) + %.3lf*e^(-∫p dx)\n", a, p+a, C);

        // Permitir calcular y(x') para vários x'
        char continuar;
        do {
            printf("\nDigite um valor x' para calcular y(x'): ");
            scanf("%lf", &xcalc);

            ycalc = exp(a*xcalc)/(p+a) + C*exp(-p*xcalc);
            printf("Resultado: y(%.3lf) = %lf\n", xcalc, ycalc);

            printf("Deseja calcular outro x'? (s/n): ");
            scanf(" %c", &continuar);
        } while (continuar == 's' || continuar == 'S');
    }
    else {
        printf("\nOpcao invalida!\n");
    }

    return 0;
}
